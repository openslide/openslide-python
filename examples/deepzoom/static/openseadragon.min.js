//! OpenSeadragon 0.9.127
//! Built on 2013-05-14
//! Git commit: v0.9.127-3-gc78f3ef
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
window.OpenSeadragon=window.OpenSeadragon||function(e){return new OpenSeadragon.Viewer(e)},function(e){var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;Array.prototype.push,Array.prototype.slice,String.prototype.trim,Array.prototype.indexOf,e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null===e||void 0===e?e+"":t[i.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(i in t);return void 0===i||n.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0}}(OpenSeadragon),function(e){function t(e,t){return t&&e!=document.body?document.body:e.offsetParent}e.extend=function(){var e,t,i,n,o,r,s=arguments[0]||{},l=arguments.length,a=!1,h=1;for("boolean"==typeof s&&(a=s,s=arguments[1]||{},h=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),l===h&&(s=this,--h);l>h;h++)if(e=arguments[h],null!==e||void 0!==e)for(t in e)i=s[t],n=e[t],s!==n&&(a&&n&&(OpenSeadragon.isPlainObject(n)||(o=OpenSeadragon.isArray(n)))?(o?(o=!1,r=i&&OpenSeadragon.isArray(i)?i:[]):r=i&&OpenSeadragon.isPlainObject(i)?i:{},s[t]=OpenSeadragon.extend(a,r,n)):void 0!==n&&(s[t]=n));return s},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:1,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,springStiffness:7,clickTimeThreshold:300,clickDistThreshold:5,zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,animationTime:1.2,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,showSequenceControl:!0,preserveViewport:!1,showNavigationControl:!0,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!0,navigatorElement:null,navigatorHeight:null,navigatorWidth:null,navigatorPosition:null,navigatorSizeRatio:.2,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,onPageChange:null,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(i){var n,o,r=new e.Point;for(i=e.getElement(i),n="fixed"==e.getElementStyle(i).position,o=t(i,n);o;)r.x+=i.offsetLeft,r.y+=i.offsetTop,n&&(r=r.plus(e.getPageScroll())),i=o,n="fixed"==e.getElementStyle(i).position,o=t(i,n);return r},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getEvent:function(t){return e.getEvent=t?function(e){return e}:function(){return window.event},e.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)e.getMousePosition=function(t){var i=new e.Point;return t=e.getEvent(t),i.x=t.pageX,i.y=t.pageY,i};else{if("number"!=typeof t.clientX)throw Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(t){var i=new e.Point;return t=e.getEvent(t),i.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},i=document.body||{};return e.getPageScroll="number"==typeof window.pageXOffset?function(){return new e.Point(window.pageXOffset,window.pageYOffset)}:i.scrollLeft||i.scrollTop?function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)}:t.scrollLeft||t.scrollTop?function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}:function(){return new e.Point(0,0)},e.getPageScroll()},getWindowSize:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!i.clientWidth&&!i.clientHeight)throw Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(t){var i,n,o=e.makeNeutralElement("div"),r=[];for(t=e.getElement(t),r.push('<div style="display:table; height:100%; width:100%;'),r.push("border:none; margin:0px; padding:0px;"),r.push('#position:relative; overflow:hidden; text-align:left;">'),r.push('<div style="#position:absolute; #top:50%; width:100%; '),r.push("border:none; margin:0px; padding:0px;"),r.push('display:table-cell; vertical-align:middle;">'),r.push('<div style="#position:relative; #top:-50%; width:100%; '),r.push("border:none; margin:0px; padding:0px;"),r.push('text-align:center;"></div></div></div>'),o.innerHTML=r.join(""),o=o.firstChild,i=o,n=o.getElementsByTagName("div");n.length>0;)i=n[0],n=i.getElementsByTagName("div");return i.appendChild(t),o},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},makeTransparentImage:function(t){return e.makeTransparentImage=function(t){var i=e.makeNeutralElement("img");return i.src=t,i},e.Browser.vendor==e.BROWSERS.IE&&7>e.Browser.version&&(e.makeTransparentImage=function(t){var i=e.makeNeutralElement("img"),n=null;return n=e.makeNeutralElement("span"),n.style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=t,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",n}),e.makeTransparentImage(t)},setElementOpacity:function(t,i,n){var o,r;if(t=e.getElement(t),n&&!e.Browser.alpha&&(i=Math.round(i)),t.style.opacity=1>i?i:"",1==i)return prevFilter=t.style.filter||"",t.style.filter=prevFilter.replace(/alpha\(.*?\)/g,""),void 0;o=Math.round(100*i),r=" alpha(opacity="+o+") ";try{t.filters&&t.filters.alpha?t.filters.alpha.opacity=o:t.style.filter+=r}catch(s){t.style.filter+=r}},addClass:function(t,i){t=e.getElement(t),t.className?-1===(" "+t.className+" ").indexOf(" "+i+" ")&&(t.className+=" "+i):t.className=i},removeClass:function(t,i){var n,o,r=[];for(t=e.getElement(t),n=t.className.split(/\s+/),o=0;n.length>o;o++)n[o]&&n[o]!==i&&r.push(n[o]);t.className=r.join(" ")},addEvent:function(t,i,n,o){if(t=e.getElement(t),t.addEventListener)e.addEvent=function(t,i,n,o){t=e.getElement(t),t.addEventListener(i,n,o)};else{if(!t.attachEvent)throw Error("Unable to attach event handler, no known technique.");e.addEvent=function(t,i,n,o){t=e.getElement(t),t.attachEvent("on"+i,n),o&&t.setCapture&&t.setCapture()}}return e.addEvent(t,i,n,o)},removeEvent:function(t,i,n,o){if(t=e.getElement(t),t.removeEventListener)e.removeEvent=function(t,i,n,o){t=e.getElement(t),t.removeEventListener(i,n,o)};else{if(!t.detachEvent)throw Error("Unable to detach event handler, no known technique.");e.removeEvent=function(t,i,n,o){t=e.getElement(t),t.detachEvent("on"+i,n),o&&t.releaseCapture&&t.releaseCapture()}}return e.removeEvent(t,i,n,o)},cancelEvent:function(t){t=e.getEvent(t),e.cancelEvent=t.preventDefault?function(e){e.preventDefault()}:function(t){t=e.getEvent(t),t.cancel=!0,t.returnValue=!1},e.cancelEvent(t)},stopEvent:function(t){t=e.getEvent(t),e.stopEvent=t.stopPropagation?function(e){e.stopPropagation()}:function(t){t=e.getEvent(t),t.cancelBubble=!0},e.stopEvent(t)},createCallback:function(e,t){var i,n=[];for(i=2;arguments.length>i;i++)n.push(arguments[i]);return function(){var i,o=n.concat([]);for(i=0;arguments.length>i;i++)o.push(arguments[i]);return t.apply(e,o)}},getUrlParameter:function(e){var t=r[e];return t?t:null},createAjaxRequest:function(){var t;if(window.ActiveXObject)for(i=0;n.length>i;i++)try{t=new ActiveXObject(n[i]),e.createAjaxRequest=function(){return new ActiveXObject(n[i])};break}catch(o){continue}else window.XMLHttpRequest&&(e.createAjaxRequest=function(){return new XMLHttpRequest},t=new XMLHttpRequest);if(!t)throw Error("Browser doesn't support XMLHttpRequest.");return t},makeAjaxRequest:function(t,i){var n,o=!0,r=e.createAjaxRequest();e.isPlainObject(t)?n.async=n.async||o:n={url:t,async:e.isFunction(i),success:i,error:null},n.async&&(r.onreadystatechange=function(){4==r.readyState&&(r.onreadystatechange=function(){},n.success(r))});try{r.open("GET",n.url,n.async),r.send(null)}catch(s){e.console.log("%s while making AJAX request: %s",s.name,s.message),r.onreadystatechange=null,r=null,n.error&&e.isFunction(n.error)&&n.error(r)}return!n.async&&e.isFunction(n.success)&&n.success(r),n.async?null:r},jsonp:function(t){var i,n=t.url,o=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+ +new Date,s=window[r],l="$1"+r+"$2",a=t.param||"callback",h=t.callback;n=n.replace(/(\=)\?(&|$)|\?\?/i,l),n+=(/\?/.test(n)?"&":"?")+a+"="+r,window[r]=function(t){if(s)window[r]=s;else try{delete window[r]}catch(i){}h&&e.isFunction(h)&&h(t)},i=document.createElement("script"),(void 0!==t.async||!1!==t.async)&&(i.async="async"),t.scriptCharset&&(i.charset=t.scriptCharset),i.src=n,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,o&&i.parentNode&&o.removeChild(i),i=void 0)},o.insertBefore(i,o.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.ActiveXObject)e.parseXml=function(e){var t=null;return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t};else{if(!window.DOMParser)throw Error("Browser doesn't support XML DOM.");e.parseXml=function(e){var t,i=null;return t=new DOMParser,i=t.parseFromString(e,"text/xml")}}return e.parseXml(t)},imageFormatSupported:function(e){return e=e?e:"",!!o[e.toLowerCase()]}}),e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var n=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],o={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},r={};(function(){var t=(navigator.appName,navigator.appVersion),i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(i.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0&&(e.Browser.vendor=i.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(t)}var n,o,s,l=window.location.search.substring(1),a=l.split("&");for(s=0;a.length>s;s++)n=a[s],o=n.indexOf("="),o>0&&(r[n.substring(0,o)]=decodeURIComponent(n.substring(o+1)));e.Browser.alpha=!(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version||e.Browser.vendor==e.BROWSERS.CHROME&&2>e.Browser.version)})();var s=function(){};e.console=window.console||{log:s,debug:s,info:s,warn:s,error:s},function(t){if(t.requestAnimationFrame=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,t.cancelAnimationFrame=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame,t.requestAnimationFrame)e.requestAnimationFrame=function(e){return t.requestAnimationFrame(e)},e.cancelAnimationFrame=function(e){return t.cancelAnimationFrame(e)};else{var i,n=[],o=0;e.requestAnimationFrame=function(e){return n.push([++o,e]),i||(i=setInterval(function(){n.length?n.shift()[1](+new Date):(clearInterval(i),i=void 0)},20)),o},e.cancelAnimationFrame=function(e){for(var t=0,i=n.length;i>t;t+=1)if(n[t][0]===e)return n.splice(t,1),void 0}}}(window)}(OpenSeadragon),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},i="webkit moz o ms khtml".split(" ");if(document.cancelFullScreen!==void 0)t.supportsFullScreen=!0;else for(var n=0,o=i.length;o>n;n++)if(t.prefix=i[n],document[t.prefix+"CancelFullScreen"]!==void 0){t.supportsFullScreen=!0;break}t.supportsFullScreen?(t.fullScreenEventName=t.prefix+"fullscreenchange",t.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},t.requestFullScreen=function(e){return""===this.prefix?e.requestFullScreen():e[this.prefix+"RequestFullScreen"]()},t.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}):window.ActiveXObject!==void 0&&(t.requestFullScreen=function(){var e=new ActiveXObject("WScript.Shell");return null!==e&&e.SendKeys("{F11}"),!1},t.cancelFullScreen=t.requestFullScreen),e.extend(e,t)}(OpenSeadragon),function(e){e.EventHandler=function(){this.events={}},e.EventHandler.prototype={addHandler:function(t,i){var n=this.events[t];n||(this.events[t]=n=[]),i&&e.isFunction(i)&&(n[n.length]=i)},removeHandler:function(t,i){var n,o=this.events[t],r=[];if(o&&e.isArray(o)){for(n=0;o.length>n;n++)o[n]!==i&&r.push(i);this.events[t]=r}},removeAllHandlers:function(e){this.events[e]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,o=t.length;for(n=0;o>n;n++)t[n]&&t[n](e,i)}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){function t(t){var i,n,o=["mouseover","mouseout","mousedown","mouseup","click","DOMMouseScroll","mousewheel","touchstart","touchmove","touchend","keypress","focus","blur"],r=B[t.hash];if(!r.tracking){for(n=0;o.length>n;n++)i=o[n],e.addEvent(t.element,i,r[i],!1);r.tracking=!0,C[t.hash]=t}}function i(t){var i,n,o=["mouseover","mouseout","mousedown","mouseup","click","DOMMouseScroll","mousewheel","touchstart","touchmove","touchend","keypress","focus","blur"],s=B[t.hash];if(s.tracking){for(n=0;o.length>n;n++)i=o[n],e.removeEvent(t.element,i,s[i],!1);r(t),s.tracking=!1,delete C[t.hash]}}function n(e){return B[e.hash].insideElement}function o(t){var i=B[t.hash];i.capturing||(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version?(e.removeEvent(t.element,"mouseup",i.mouseup,!1),e.addEvent(t.element,"mouseup",i.mouseupie,!0),e.addEvent(t.element,"mousemove",i.mousemoveie,!0)):(e.addEvent(window,"mouseup",i.mouseupwindow,!0),e.addEvent(window,"mousemove",i.mousemove,!0)),i.capturing=!0)}function r(t){var i=B[t.hash];i.capturing&&(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version?(e.removeEvent(t.element,"mousemove",i.mousemoveie,!0),e.removeEvent(t.element,"mouseup",i.mouseupie,!0),e.addEvent(t.element,"mouseup",i.mouseup,!1)):(e.removeEvent(window,"mousemove",i.mousemove,!0),e.removeEvent(window,"mouseup",i.mouseupwindow,!0)),i.capturing=!1)}function s(e,t,i){var n;for(n in C)C.hasOwnProperty(n)&&e.hash!=n&&t(C[n],i)}function l(t,i){var n;t.focusHandler&&(n=t.focusHandler(t,i),n===!1&&e.cancelEvent(i))}function a(t,i){var n;t.blurHandler&&(n=t.blurHandler(t,i),n===!1&&e.cancelEvent(i))}function h(t,i){var n;t.keyHandler&&(n=t.keyHandler(t,i.keyCode?i.keyCode:i.charCode,i.shiftKey),n||e.cancelEvent(i))}function c(t,i){var n,o=B[t.hash];i=e.getEvent(i),e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&o.capturing&&!O(i.srcElement,t.element)&&s(t,c,i);var r=i.target?i.target:i.srcElement,l=i.relatedTarget?i.relatedTarget:i.fromElement;O(t.element,r)&&!O(t.element,l)&&(o.insideElement=!0,t.enterHandler&&(n=t.enterHandler(t,R(i,t.element),o.buttonDown,z),n===!1&&e.cancelEvent(i)))}function u(t,i){var n,o=B[t.hash];i=e.getEvent(i),e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&o.capturing&&!O(i.srcElement,t.element)&&s(t,u,i);var r=i.target?i.target:i.srcElement,l=i.relatedTarget?i.relatedTarget:i.toElement;O(t.element,r)&&!O(t.element,l)&&(o.insideElement=!1,t.exitHandler&&(n=t.exitHandler(t,R(i,t.element),o.buttonDown,z),n===!1&&e.cancelEvent(i)))}function m(t,i){var n,r=B[t.hash];i=e.getEvent(i),2!=i.button&&(r.buttonDown=!0,r.lastPoint=b(i),r.lastMouseDownPoint=r.lastPoint,r.lastMouseDownTime=+new Date,t.pressHandler&&(n=t.pressHandler(t,R(i,t.element)),n===!1&&e.cancelEvent(i)),(t.pressHandler||t.dragHandler)&&e.cancelEvent(i),e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&I?e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&k.push(t):(o(t),I=!0,k=[t]))}function p(t,i){var n,o;1==i.touches.length&&1==i.targetTouches.length&&1==i.changedTouches.length&&(B[t.hash].lastTouch=i.touches[0],c(t,i.changedTouches[0]),m(t,i.touches[0])),2==i.touches.length&&(n=b(i.touches[0]),o=b(i.touches[1]),B[t.hash].lastPinchDelta=Math.abs(n.x-o.x)+Math.abs(n.y-o.y),B[t.hash].pinchMidpoint=new e.Point((n.x+o.x)/2,(n.y+o.y)/2)),i.preventDefault()}function d(t,i){var n,o=B[t.hash],r=o.buttonDown,s=o.insideElement;i=e.getEvent(i),2!=i.button&&(o.buttonDown=!1,t.releaseHandler&&(n=t.releaseHandler(t,R(i,t.element),r,s),n===!1&&e.cancelEvent(i)),r&&s&&S(t,i))}function g(e,t){0===t.touches.length&&0===t.targetTouches.length&&1==t.changedTouches.length&&(B[e.hash].lastTouch=null,d(e,t.changedTouches[0]),u(e,t.changedTouches[0])),2==t.touches.length+t.changedTouches.length&&(B[e.hash].lastPinchDelta=null,B[e.hash].pinchMidpoint=null),t.preventDefault()}function v(t,i){var o,s;if(i=e.getEvent(i),2!=i.button){for(s=0;k.length>s;s++)o=k[s],n(o)||d(o,i);r(t),I=!1,i.srcElement.fireEvent("on"+i.type,document.createEventObject(i)),e.stopEvent(i)}}function f(e,t){B[e.hash].insideElement||d(e,t),r(e)}function w(t,i){t.clickHandler&&e.cancelEvent(i)}function y(t,i){var n,o=0;i||(i=window.event),i.wheelDelta?(o=i.wheelDelta,window.opera&&(o=-o)):i.detail&&(o=-i.detail),o=o>0?1:-1,t.scrollHandler&&(n=t.scrollHandler(t,R(i,t.element),o,i.shiftKey),n===!1&&e.cancelEvent(i))}function S(t,i){var n,o=B[t.hash];if(i=e.getEvent(i),2!=i.button){var r=+new Date-o.lastMouseDownTime,s=b(i),l=o.lastMouseDownPoint.distanceTo(s),a=t.clickTimeThreshold>=r&&t.clickDistThreshold>=l;t.clickHandler&&(n=t.clickHandler(t,R(i,t.element),a,i.shiftKey),n===!1&&e.cancelEvent(i))}}function T(t,i){var n,o,r,s=B[t.hash];i=e.getEvent(i),r=b(i),n=r.minus(s.lastPoint),s.lastPoint=r,t.dragHandler&&(o=t.dragHandler(t,R(i,t.element),n,i.shiftKey),o===!1&&e.cancelEvent(i))}function x(e,t){var i,n,o;1===t.touches.length&&1===t.targetTouches.length&&1===t.changedTouches.length&&B[e.hash].lastTouch.identifier===t.touches[0].identifier?T(e,t.touches[0]):2===t.touches.length&&(i=b(t.touches[0]),n=b(t.touches[1]),o=Math.abs(i.x-n.x)+Math.abs(i.y-n.y),Math.abs(B[e.hash].lastPinchDelta-o)>75&&(y(e,{shift:!1,pageX:B[e.hash].pinchMidpoint.x,pageY:B[e.hash].pinchMidpoint.y,detail:B[e.hash].lastPinchDelta>o?1:-1}),B[e.hash].lastPinchDelta=o)),t.preventDefault()}function E(t,i){var n;for(n=0;k.length>n;n++)T(k[n],i);e.stopEvent(i)}function b(t){return e.getMousePosition(t)}function R(t,i){var n=e.getMousePosition(t),o=e.getElementPosition(i);return n.minus(o)}function O(e,t){for(var i=document.body;t&&e!=t&&i!=t;)try{t=t.parentNode}catch(n){return!1}return e==t}function H(){z=!0}function P(){z=!1}var z=!1,I=!1,C={},k=[],B={};e.MouseTracker=function(t){var i=arguments;e.isPlainObject(t)||(t={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.releaseHandler=t.releaseHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dragHandler=t.dragHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var n=this;B[this.hash]={mouseover:function(e){c(n,e)},mouseout:function(e){u(n,e)},mousedown:function(e){m(n,e)},mouseup:function(e){d(n,e)},click:function(e){w(n,e)},DOMMouseScroll:function(e){y(n,e)},mousewheel:function(e){y(n,e)},mouseupie:function(e){v(n,e)},mousemoveie:function(e){E(n,e)},mouseupwindow:function(e){f(n,e)},mousemove:function(e){T(n,e)},touchstart:function(e){p(n,e)},touchmove:function(e){x(n,e)},touchend:function(e){g(n,e)},keypress:function(e){h(n,e)},focus:function(e){l(n,e)},blur:function(e){a(n,e)},tracking:!1,capturing:!1,buttonDown:!1,insideElement:!1,lastPoint:null,lastMouseDownTime:null,lastMouseDownPoint:null,lastPinchDelta:0}},e.MouseTracker.prototype={isTracking:function(){return B[this.hash].tracking},setTracking:function(e){return e?t(this):i(this),this},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},releaseHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dragHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},function(){e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version?(e.addEvent(document,"mousedown",H,!1),e.addEvent(document,"mouseup",P,!1)):(e.addEvent(window,"mousedown",H,!0),e.addEvent(window,"mouseup",P,!0))}()}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.Control=function(t,i,n){this.element=t,this.anchor=i,this.container=n,this.wrapper=e.makeNeutralElement("span"),this.wrapper.style.display="inline-block",this.wrapper.appendChild(this.element),this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%"),this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==t)return i;return-1}e.ControlDock=function(t){var i,n,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+ +new Date+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("form"),controls:[]},t),this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;o.length>n;n++)i=o[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){i=e.getElement(i);var o=null;if(!(t(this,i)>=0)){switch(n){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;default:case e.ControlAnchor.NONE:o=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,o)),i.style.display="inline-block"}},removeControl:function(i){i=e.getElement(i);var n=t(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function($){function openTileSource(e,t){var i,n,o=e;for(o.source&&o.close(),o.canvas.innerHTML="",THIS[o.hash].prevContainerSize=$.getElementSize(o.container),o.collectionMode?(o.source=new $.TileSourceCollection({rows:o.collectionRows,layout:o.collectionLayout,tileSize:o.collectionTileSize,tileSources:o.tileSources,tileMargin:o.collectionTileMargin}),o.viewport=o.viewport?o.viewport:new $.Viewport({collectionMode:!0,collectionTileSource:o.source,containerSize:THIS[o.hash].prevContainerSize,contentSize:o.source.dimensions,springStiffness:o.springStiffness,animationTime:o.animationTime,showNavigator:!1,minZoomImageRatio:1,maxZoomPixelRatio:1,viewer:o})):(t&&(o.source=t),o.viewport=o.viewport?o.viewport:new $.Viewport({containerSize:THIS[o.hash].prevContainerSize,contentSize:o.source.dimensions,springStiffness:o.springStiffness,animationTime:o.animationTime,minZoomImageRatio:o.minZoomImageRatio,maxZoomPixelRatio:o.maxZoomPixelRatio,visibilityRatio:o.visibilityRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,defaultZoomLevel:o.defaultZoomLevel,minZoomLevel:o.minZoomLevel,maxZoomLevel:o.maxZoomLevel,viewer:o})),o.preserveViewport&&o.viewport.resetContentSize(o.source.dimensions),o.source.overlays=o.source.overlays||[],o.drawer=new $.Drawer({source:o.source,viewport:o.viewport,element:o.canvas,overlays:[].concat(o.overlays).concat(o.source.overlays),maxImageCacheCount:o.maxImageCacheCount,imageLoaderLimit:o.imageLoaderLimit,minZoomImageRatio:o.minZoomImageRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,immediateRender:o.immediateRender,blendTime:o.blendTime,alwaysBlend:o.alwaysBlend,minPixelRatio:o.collectionMode?0:o.minPixelRatio,timeout:o.timeout,debugMode:o.debugMode,debugGridColor:o.debugGridColor}),!o.showNavigator||o.navigator||o.collectionMode||(o.navigator=new $.Navigator({id:o.navigatorElement,position:o.navigatorPosition,sizeRatio:o.navigatorSizeRatio,height:o.navigatorHeight,width:o.navigatorWidth,tileSources:o.tileSources,tileHost:o.tileHost,prefixUrl:o.prefixUrl,overlays:o.overlays,viewer:o})),o.showReferenceStrip&&!o.referenceStrip&&(o.referenceStrip=new $.ReferenceStrip({id:o.referenceStripElement,position:o.referenceStripPosition,sizeRatio:o.referenceStripSizeRatio,scroll:o.referenceStripScroll,height:o.referenceStripHeight,width:o.referenceStripWidth,tileSources:o.tileSources,tileHost:o.tileHost,prefixUrl:o.prefixUrl,overlays:o.overlays,viewer:o})),THIS[o.hash].animating=!1,THIS[o.hash].forceRedraw=!0,THIS[o.hash].updateRequestId=scheduleUpdate(o,updateMulti),n=0;o.overlayControls.length>n;n++)i=o.overlayControls[n],i.point?o.drawer.addOverlay(i.id,new $.Point(i.point.X,i.point.Y),$.OverlayPlacement.TOP_LEFT):o.drawer.addOverlay(i.id,new $.Rect(i.rect.Point.X,i.rect.Point.Y,i.rect.Width,i.rect.Height),i.placement);return VIEWERS[o.hash]=o,o.navigator&&o.navigator.open(t),o.raiseEvent("open",{source:t,viewer:o}),o}function scheduleUpdate(e,t,i){var n,o,r;return THIS[e.hash].animating?$.requestAnimationFrame(function(){t(e)}):(n=+new Date,i=i?i:n,o=i+1e3/60,r=Math.max(1,o-n),$.requestAnimationFrame(function(){t(e)}))}function scheduleControlsFade(e){$.requestAnimationFrame(function(){updateControlsFade(e)})}function beginControlsAutoHide(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=+new Date+e.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(e)},e.controlsFadeDelay))}function updateControlsFade(e){var t,i,n,o;if(e.controlsShouldFade){for(t=(new Date).getTime(),i=t-e.controlsFadeBeginTime,n=1-i/e.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n),o=e.controls.length-1;o>=0;o--)e.controls[o].setOpacity(n);n>0&&scheduleControlsFade(e)}}function abortControlsAutoHide(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasClick(e,t,i,n){var o;this.viewport&&i&&(zoomPerClick=this.zoomPerClick,o=n?1/zoomPerClick:zoomPerClick,this.viewport.zoomBy(o,this.viewport.pointFromPixel(t,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-click",{tracker:e,position:t,quick:i,shift:n})}function onCanvasDrag(e,t,i,n){this.viewport&&(this.panHorizontal||(i.x=0),this.panVertical||(i.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(i.negate())),this.constrainDuringPan&&this.viewport.applyConstraints()),this.raiseEvent("canvas-click",{tracker:e,position:t,delta:i,shift:n})}function onCanvasRelease(e,t,i,n){i&&this.viewport&&this.viewport.applyConstraints(),this.raiseEvent("canvas-release",{tracker:e,position:t,insideElementPress:i,insideElementRelease:n})}function onCanvasScroll(e,t,i,n){var o;return this.viewport&&(o=Math.pow(this.zoomPerScroll,i),this.viewport.zoomBy(o,this.viewport.pointFromPixel(t,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:e,position:t,scroll:i,shift:n}),!1}function onContainerExit(e,t,i,n){i||(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:e,position:t,buttonDownElement:i,buttonDownAny:n})}function onContainerRelease(e,t,i,n){n||(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-release",{tracker:e,position:t,insideElementPress:i,insideElementRelease:n})
}function onContainerEnter(e,t,i,n){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:e,position:t,buttonDownElement:i,buttonDownAny:n})}function updateMulti(e){var t;return e.source?(t=+new Date,updateOnce(e),THIS[e.hash].updateRequestId=scheduleUpdate(e,arguments.callee,t),void 0):(THIS[e.hash].updateRequestId=null,void 0)}function updateOnce(e){var t,i;e.source&&(t=$.getElementSize(e.container),t.equals(THIS[e.hash].prevContainerSize)||(e.viewport.resize(t,!0),THIS[e.hash].prevContainerSize=t),i=e.viewport.update(),e.referenceStrip&&(i=e.referenceStrip.update(e.viewport)||i),!THIS[e.hash].animating&&i&&(e.raiseEvent("animationstart"),abortControlsAutoHide(e)),i?(e.drawer.update(),e.navigator&&e.navigator.update(e.viewport),e.raiseEvent("animation")):(THIS[e.hash].forceRedraw||e.drawer.needsUpdate())&&(e.drawer.update(),e.navigator&&e.navigator.update(e.viewport),THIS[e.hash].forceRedraw=!1),THIS[e.hash].animating&&!i&&(e.raiseEvent("animationfinish"),THIS[e.hash].mouseInside||beginControlsAutoHide(e)),THIS[e.hash].animating=i)}function resolveUrl(e,t){return e?e+t:t}function beginZoomingIn(){THIS[this.hash].lastZoomTime=+new Date,THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=+new Date,THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(e){$.requestAnimationFrame($.delegate(e,doZoom))}function doZoom(){var e,t;THIS[this.hash].zooming&&this.viewport&&(e=+new Date,t=e-THIS[this.hash].lastZoomTime,adjustedFactor=Math.pow(THIS[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(adjustedFactor),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=e,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullPage(){this.setFullPage(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onPrevious(){var e=THIS[this.hash].sequence-1;this.goToPage(e)}function onNext(){var e=THIS[this.hash].sequence+1;this.goToPage(e)}var THIS={},VIEWERS={};$.Viewer=function(e){var t,i=arguments,n=this;$.isPlainObject(e)||(e={id:i[0],xmlPath:i.length>1?i[1]:void 0,prefixUrl:i.length>2?i[2]:void 0,controls:i.length>3?i[3]:void 0,overlays:i.length>4?i[4]:void 0,overlayControls:i.length>5?i[5]:void 0}),e.config&&($.extend(!0,e,e.config),delete e.config),$.extend(!0,this,{id:e.id,hash:e.id,element:null,canvas:null,container:null,overlays:[],overlayControls:[],previousBody:[],customControls:[],source:null,drawer:null,drawers:[],viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,e),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,updateRequestId:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,sequenced:!1,sequence:0,fullPage:!1,onfullscreenchange:null},$.EventHandler.call(this),$.ControlDock.call(this,e);var o;for(this.xmlPath&&(this.tileSources=[this.xmlPath]),this.tileSources&&($.isArray(this.tileSources)?(this.tileSources.length>1&&(THIS[this.hash].sequenced=!0),o=this.tileSources[0]):o=this.tileSources,this.open(o)),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new $.MouseTracker({element:this.canvas,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,clickHandler:$.delegate(this,onCanvasClick),dragHandler:$.delegate(this,onCanvasDrag),releaseHandler:$.delegate(this,onCanvasRelease),scrollHandler:$.delegate(this,onCanvasScroll)}).setTracking(this.mouseNavEnabled?!0:!1),this.outerTracker=new $.MouseTracker({element:this.container,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit),releaseHandler:$.delegate(this,onContainerRelease)}).setTracking(this.mouseNavEnabled?!0:!1),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),this.bindSequenceControls(),t=0;this.customControls.length>t;t++)this.addControl(this.customControls[t].id,this.customControls[t].anchor);$.requestAnimationFrame(function(){beginControlsAutoHide(n)})},$.extend($.Viewer.prototype,$.EventHandler.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.source},openDzi:function(e){return this.open(e)},openTileSource:function(e){return this.open(e)},open:function(tileSource){var _this=this,customTileSource,readySource,$TileSource,options;return"string"==$.type(tileSource)&&(tileSource.match(/\s*<.*/)?tileSource=$.parseXml(tileSource):tileSource.match(/\s*[\{\[].*/)&&(tileSource=eval("("+tileSource+")"))),setTimeout(function(){"string"==$.type(tileSource)?tileSource=new $.TileSource(tileSource,function(e){openTileSource(_this,e)}):$.isPlainObject(tileSource)||tileSource.nodeType?$.isFunction(tileSource.getTileUrl)?(customTileSource=new $.TileSource(tileSource),customTileSource.getTileUrl=tileSource.getTileUrl,openTileSource(_this,customTileSource)):($TileSource=$.TileSource.determineType(_this,tileSource),options=$TileSource.prototype.configure.apply(_this,[tileSource]),readySource=new $TileSource(options),openTileSource(_this,readySource)):openTileSource(_this,tileSource)},1),this},close:function(){return null!==THIS[this.hash].updateRequestId&&($.cancelAnimationFrame(THIS[this.hash].updateRequestId),THIS[this.hash].updateRequestId=null),this.drawer&&this.drawer.clearOverlays(),this.source=null,this.drawer=null,this.viewport=this.preserveViewport?this.viewport:null,this.canvas.innerHTML="",VIEWERS[this.hash]=null,delete VIEWERS[this.hash],this.raiseEvent("close",{viewer:this}),this},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e,viewer:this}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;this.controls.length>e;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?abortControlsAutoHide(this):beginControlsAutoHide(this),this.raiseEvent("controls-enabled",{enabled:e,viewer:this}),this},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(e){var t,i,n,o,r,s,l=document.body,a=l.style,h=document.documentElement.style,c=(this.element.style,this.canvas.style),u=this;if(e!=this.isFullPage()){if(e){for(this.bodyOverflow=a.overflow,this.docOverflow=h.overflow,a.overflow="hidden",h.overflow="hidden",this.bodyWidth=a.width,this.bodyHeight=a.height,a.width="100%",a.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementSize=$.getElementSize(this.element),r=l.childNodes.length,s=0;r>s;s++)this.previousBody.push(l.childNodes[0]),l.removeChild(l.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,l.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),l.appendChild(this.element),$.supportsFullScreen?(THIS[this.hash].onfullscreenchange=function(){$.isFullScreen()?u.setFullPage(!0):u.setFullPage(!1)},$.requestFullScreen(document.body),document.addEventListener($.fullScreenEventName,THIS[this.hash].onfullscreenchange),this.element.style.height="100%",this.element.style.width="100%"):(this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px"),this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)()}else{for($.supportsFullScreen&&(document.removeEventListener($.fullScreenEventName,THIS[this.hash].onfullscreenchange),$.cancelFullScreen(document)),a.overflow=this.bodyOverflow,h.overflow=this.docOverflow,a.width=this.bodyWidth,a.height=this.bodyHeight,c.backgroundColor="",c.color="",l.removeChild(this.element),r=this.previousBody.length,s=0;r>s;s++)l.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(l.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.height=THIS[this.hash].prevElementSize.y+"px",this.element.style.width=THIS[this.hash].prevElementSize.x+"px",THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)()}if(this.raiseEvent("fullpage",{fullpage:e,viewer:this}),this.viewport){if(t=this.viewport.getBounds(),this.viewport.resize(THIS[this.hash].prevContainerSize),i=this.viewport.getBounds(),e)THIS[this.hash].fsBoundsDelta=new $.Point(i.width/t.width,i.height/t.height);else{this.viewport.update(),this.viewport.zoomBy(Math.max(THIS[this.hash].fsBoundsDelta.x,THIS[this.hash].fsBoundsDelta.y),null,!0);for(o in VIEWERS)n=VIEWERS[o],n!==this&&n!=this.navigator&&(n.open(n.source),n.navigator&&n.navigator.open(n.source))}THIS[this.hash].forceRedraw=!0,updateOnce(this)}return this}},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e,viewer:this}),this},bindSequenceControls:function(){var e=$.delegate(this,onFocus),t=$.delegate(this,onBlur),i=$.delegate(this,onNext),n=$.delegate(this,onPrevious),o=this.navImages,r=!0;return this.showSequenceControl&&THIS[this.hash].sequenced&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,o.previous.REST),srcGroup:resolveUrl(this.prefixUrl,o.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,o.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,o.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,o.next.REST),srcGroup:resolveUrl(this.prefixUrl,o.next.GROUP),srcHover:resolveUrl(this.prefixUrl,o.next.HOVER),srcDown:resolveUrl(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.previousButton.disable(),r&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,$.ControlAnchor.BOTTOM_RIGHT):this.addControl(this.pagingControl,$.ControlAnchor.TOP_LEFT))),this},bindStandardControls:function(){var e=$.delegate(this,beginZoomingIn),t=$.delegate(this,endZooming),i=$.delegate(this,doSingleZoomIn),n=$.delegate(this,beginZoomingOut),o=$.delegate(this,doSingleZoomOut),r=$.delegate(this,onHome),s=$.delegate(this,onFullPage),l=$.delegate(this,onFocus),a=$.delegate(this,onBlur),h=this.navImages,c=[],u=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton)&&(u=!1),c.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,h.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,h.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,h.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,h.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:l,onBlur:a})),c.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,h.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,h.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,h.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,h.zoomOut.DOWN),onPress:n,onRelease:t,onClick:o,onEnter:n,onExit:t,onFocus:l,onBlur:a})),c.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,h.home.REST),srcGroup:resolveUrl(this.prefixUrl,h.home.GROUP),srcHover:resolveUrl(this.prefixUrl,h.home.HOVER),srcDown:resolveUrl(this.prefixUrl,h.home.DOWN),onRelease:r,onFocus:l,onBlur:a})),c.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,h.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,h.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,h.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,h.fullpage.DOWN),onRelease:s,onFocus:l,onBlur:a})),u&&(this.buttons=new $.ButtonGroup({buttons:c,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),this.toolbar?this.toolbar.addControl(this.navControl,$.ControlAnchor.TOP_LEFT):this.addControl(this.navControl,$.ControlAnchor.TOP_LEFT))),this},goToPage:function(e){return this.raiseEvent("page",{page:e,viewer:this}),this.tileSources.length>e&&(THIS[this.hash].sequence=e,this.nextButton&&(this.tileSources.length-1===e?this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(e>0?this.previousButton.enable():this.previousButton.disable()),this.open(this.tileSources[e])),$.isFunction(this.onPageChange)&&this.onPageChange({page:e,viewer:this}),this.referenceStrip&&this.referenceStrip.setFocus(e),this}})}(OpenSeadragon),function(e){function t(){this.displayRegion.focus()}function i(e,t,i){this.viewer.viewport&&(this.panHorizontal||(i.x=0),this.panVertical||(i.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(i)))}function n(e,t,i){i&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(e,t,i){var n;return this.viewer.viewport&&(n=Math.pow(this.zoomPerScroll,i),this.viewer.viewport.zoomBy(n,this.viewport.getCenter()),this.viewer.viewport.applyConstraints()),!1}e.Navigator=function(r){var s=this,l=r.viewer,a=e.getElementSize(l.element);r.id||(r.id="navigator-"+ +new Date,this.element=e.makeNeutralElement("div"),this.element.id=r.id,this.element.className="navigator"),r=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},r,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),r.minPixelRatio=this.minPixelRatio=l.minPixelRatio,function(e){e.marginTop="0px",e.marginRight="0px",e.marginBottom="0px",e.marginLeft="0px",e.border="2px solid #555",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style),this.displayRegion=e.makeNeutralElement("textarea"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border="2px solid #900",e.background="transparent",e["float"]="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style),this.element.innerTracker=new e.MouseTracker({element:this.element,scrollHandler:function(){return!1}}).setTracking(!0),this.displayRegion.innerTracker=new e.MouseTracker({element:this.displayRegion,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,clickHandler:e.delegate(this,t),dragHandler:e.delegate(this,i),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,o),focusHandler:function(){var t=e.getElementPosition(s.viewer.element);window.scrollTo(0,t.y),s.viewer.setControlsEnabled(!0),function(e){e.border="2px solid #437AB2"}(this.element.style)},blurHandler:function(){s.viewer.setControlsEnabled(!1),function(e){e.border="2px solid #900"}(this.element.style)},keyHandler:function(t,i,n){switch(i){case 61:return s.viewer.viewport.zoomBy(1.1),s.viewer.viewport.applyConstraints(),!1;case 45:return s.viewer.viewport.zoomBy(.9),s.viewer.viewport.applyConstraints(),!1;case 48:return s.viewer.viewport.goHome(),s.viewer.viewport.applyConstraints(),!1;case 119:case 87:case 38:return n?s.viewer.viewport.zoomBy(1.1):s.viewer.viewport.panBy(new e.Point(0,-.05)),s.viewer.viewport.applyConstraints(),!1;case 115:case 83:case 40:return n?s.viewer.viewport.zoomBy(.9):s.viewer.viewport.panBy(new e.Point(0,.05)),s.viewer.viewport.applyConstraints(),!1;case 97:case 37:return s.viewer.viewport.panBy(new e.Point(-.05,0)),s.viewer.viewport.applyConstraints(),!1;case 100:case 39:return s.viewer.viewport.panBy(new e.Point(.05,0)),s.viewer.viewport.applyConstraints(),!1;default:return!0}}}).setTracking(!0),l.addControl(this.element,e.ControlAnchor.TOP_RIGHT),r.width&&r.height?(this.element.style.width=r.width+"px",this.element.style.height=r.height+"px"):(this.element.style.width=a.x*r.sizeRatio+"px",this.element.style.height=a.y*r.sizeRatio+"px"),e.Viewer.apply(this,[r]),this.element.getElementsByTagName("form")[0].appendChild(this.displayRegion)},e.extend(e.Navigator.prototype,e.EventHandler.prototype,e.Viewer.prototype,{update:function(e){var t,i,n;e&&this.viewport&&(t=e.getBounds(!0),i=this.viewport.pixelFromPoint(t.getTopLeft()),n=this.viewport.pixelFromPoint(t.getBottomRight()),function(e){e.top=i.y+"px",e.left=i.x+"px";var t=Math.abs(i.x-n.x)-3,o=Math.abs(i.y-n.y)-3;e.width=Math.max(t,0)+"px",e.height=Math.max(o,0)+"px"}(this.displayRegion.style))},open:function(t){var i=this.viewer.viewport.containerSize.times(this.sizeRatio);return this.minPixelRatio=t.tileSize>i.x||t.tileSize>i.y?Math.min(i.x,i.y)/t.tileSize:this.viewer.minPixelRatio,e.Viewer.prototype.open.apply(this,[t])}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1})."},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page"}};e.extend(e,{getString:function(e){var i,n=e.split("."),o=null,r=arguments,s=t;for(i=0;n.length-1>i;i++)s=s[n[i]]||{};return o=s[n[i]],"string"!=typeof o&&(o=""),o.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return r.length>t?r[t]:""})},setString:function(e,i){var n,o=e.split("."),r=t;for(n=0;o.length-1>n;n++)r[o[n]]||(r[o[n]]={}),r=r[o[n]];r[o[n]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},toString:function(){return"("+Math.round(this.x)+","+Math.round(this.y)+")"}}}(OpenSeadragon),function($){function processResponse(xhr){var responseText=xhr.responseText,status=xhr.status,statusText,data;if(!xhr)throw Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,Error($.getString("Errors.Status",status,statusText));if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else data=responseText.match(/\s*[\{\[].*/)?eval("("+responseText+")"):responseText;return data}$.TileSource=function(e){var t,i,n=null,o=arguments;for(t=$.isPlainObject(e)?e:{width:o[0],height:o[1],tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},$.EventHandler.call(this),$.extend(!0,this,t),i=0;arguments.length>i;i++)if($.isFunction(arguments[i])){n=arguments[i],this.addHandler("ready",function(e,t){n(t)});break}"string"==$.type(arguments[0])?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this.tileSize=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(arguments[0])):(this.ready=!0,this.aspectRatio=t.width&&t.height?t.width/t.height:1,this.dimensions=new $.Point(t.width,t.height),this.tileSize=t.tileSize?t.tileSize:0,this.tileOverlap=t.tileOverlap?t.tileOverlap:0,this.minLevel=t.minLevel?t.minLevel:0,this.maxLevel=void 0!==t.maxLevel&&null!==t.maxLevel?t.maxLevel:t.width&&t.height?Math.ceil(Math.log(Math.max(t.width,t.height))/Math.log(2)):0,n&&$.isFunction(n)&&n(this))},$.TileSource.prototype={getLevelScale:function(e){var t,i={};for(t=0;this.maxLevel>=t;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.tileSize),n=Math.ceil(t*this.dimensions.y/this.tileSize);return new $.Point(i,n)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),i=1/t.x,n=1/t.y;return new $.Point(i,n)},getClosestLevel:function(e){var t,i,n=Math.floor(Math.max(e.x,e.y)/this.tileSize);for(t=this.minLevel;this.maxLevel>t&&(i=this.getNumTiles(t),!(Math.max(i.x,i.y)+1>=n));t++);return Math.max(0,t-1)},getTileAtPoint:function(e,t){var i=t.times(this.dimensions.x).times(this.getLevelScale(e)),n=Math.floor(i.x/this.tileSize),o=Math.floor(i.y/this.tileSize);return new $.Point(n,o)},getTileBounds:function(e,t,i){var n=this.dimensions.times(this.getLevelScale(e)),o=0===t?0:this.tileSize*t-this.tileOverlap,r=0===i?0:this.tileSize*i-this.tileOverlap,s=this.tileSize+(0===t?1:2)*this.tileOverlap,l=this.tileSize+(0===i?1:2)*this.tileOverlap,a=1/n.x;return s=Math.min(s,n.x-o),l=Math.min(l,n.y-r),new $.Rect(o*a,r*a,s*a,l*a)},getImageInfo:function(e){var t,i,n,o,r,s,l,a=this;e&&(r=e.split("/"),s=r[r.length-1],l=s.lastIndexOf("."),l>-1&&(r[r.length-1]=s.slice(0,l))),i=function(t){var i=$.TileSource.determineType(a,t,e);o=i.prototype.configure.apply(a,[t,e]),n=new i(o),a.ready=!0,a.raiseEvent("ready",n)},e.match(/\.js$/)?(t=e.split("/").pop().replace(".js",""),$.jsonp({url:e,async:!1,callbackName:t,callback:i})):$.makeAjaxRequest(e,function(e){var t=processResponse(e);i(t)})},supports:function(){return!1},configure:function(){throw Error("Method not implemented.")},getTileUrl:function(){throw Error("Method not implemented.")},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&this.maxLevel>=e&&t>=0&&i>=0&&n.x>t&&n.y>i}},$.extend(!0,$.TileSource.prototype,$.EventHandler.prototype),$.TileSource.determineType=function(e,t,i){var n;for(n in OpenSeadragon)if(n.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[n])&&$.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(e,t,i))return OpenSeadragon[n]}}(OpenSeadragon),function(e){function t(t,n){if(!n||!n.documentElement)throw Error(e.getString("Errors.Xml"));var o,r,s,l,a,h=n.documentElement,c=h.tagName,u=null,m=[];if("Image"==c)try{if(l=h.getElementsByTagName("Size")[0],u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(l.getAttribute("Height"),10),Width:parseInt(l.getAttribute("Width"),10)}}},!e.imageFormatSupported(u.Image.Format))throw Error(e.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(o=h.getElementsByTagName("DisplayRect"),a=0;o.length>a;a++)r=o[a],s=r.getElementsByTagName("Rect")[0],m.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return m.length&&(u.Image.DisplayRect=m),i(t,u)}catch(p){throw p instanceof Error?p:Error(e.getString("Errors.Dzi"))}else{if("Collection"==c)throw Error(e.getString("Errors.Dzc"));if("Error"==c)return processDZIError(h)}throw Error(e.getString("Errors.Dzi"))}function i(t,i){var n,o,r=i.Image,s=r.Url,l=r.Format,a=r.Size,h=r.DisplayRect||[],c=parseInt(a.Width,10),u=parseInt(a.Height,10),m=parseInt(r.TileSize,10),p=parseInt(r.Overlap,10),d=[];for(o=0;h.length>o;o++)n=h[o].Rect,d.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:c,height:u,tileSize:m,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:l,displayRects:d},i)}e.DziTileSource=function(t){var i,n,o,r;if(r=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=r.tilesUrl,this.fileFormat=r.fileFormat,this.displayRects=r.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(n=this.displayRects[i],o=n.minLevel;n.maxLevel>=o;o++)this._levelRects[o]||(this._levelRects[o]=[]),this._levelRects[o].push(n);e.TileSource.apply(this,[r])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e){var t;return e.Image?t=e.Image.xmlns:e.documentElement&&"Image"==e.documentElement.tagName&&(t=e.documentElement.namespaceURI),"http://schemas.microsoft.com/deepzoom/2008"==t||"http://schemas.microsoft.com/deepzoom/2009"==t},configure:function(n,o){var r;return r=e.isPlainObject(n)?i(this,n):t(this,n),o&&!r.tilesUrl&&(r.tilesUrl=o.replace(/([^\/]+)\.(dzi|xml|js)$/,"$1_files/")),r},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat].join("")},tileExists:function(e,t,i){var n,o,r,s,l,a,h,c=this._levelRects[e];if(!c||!c.length)return!0;for(h=c.length-1;h>=0;h--)if(n=c[h],!(n.minLevel>e||e>n.maxLevel)&&(o=this.getLevelScale(e),r=n.x*o,s=n.y*o,l=r+n.width*o,a=s+n.height*o,r=Math.floor(r/this.tileSize),s=Math.floor(s/this.tileSize),l=Math.ceil(l/this.tileSize),a=Math.ceil(a/this.tileSize),t>=r&&l>t&&i>=s&&a>i))return!0;return!1}})}(OpenSeadragon),function(e){function t(t,o){if(!o||!o.documentElement)throw Error(e.getString("Errors.Xml"));var r=o.documentElement,s=r.tagName,l=null;if("info"==s)try{return l={ns:r.namespaceURI},i(r,l),n(t,l)}catch(a){throw a instanceof Error?a:Error(e.getString("Errors.IIIF"))}throw Error(e.getString("Errors.IIIF"))}function i(t,n,o){var r,s;if(3==t.nodeType&&o)s=t.nodeValue.trim(),s.match(/^\d*$/)&&(s=Number(s)),n[o]?(e.isArray(n[o])||(n[o]=[n[o]]),n[o].push(s)):n[o]=s;else if(1==t.nodeType)for(r=0;t.childNodes.length>r;r++)i(t.childNodes[r],n,t.nodeName)}function n(e,t){return t.image_host&&(t.tilesUrl=t.image_host),t}e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this.identifier&&this.tilesUrl))throw Error("IIIF required parameters not provided.");t.tileSize=this.tile_width,t.maxLevel=t.maxLevel?t.maxLevel:Number(Math.ceil(Math.log(Math.max(this.width,this.height),2))),e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.ns&&"http://library.stanford.edu/iiif/image-api/ns/"==e.ns||e.profile&&("http://library.stanford.edu/iiif/image-api/compliance.html#level1"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html#level2"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html#level3"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html"==e.profile)||e.documentElement&&"info"==e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==e.documentElement.namespaceURI},configure:function(i,o){var r,s,l;return s=e.isPlainObject(i)?n(this,i):t(this,i),o&&!s.tilesUrl&&(r=o.split("/"),r.pop(),r=r.join("/"),"http"!==o.substring(0,4)&&(l=location.protocol+"//"+location.host,r=l+r),s.tilesUrl=r.replace(i.identifier,"")),s},getTileUrl:function(e,t,i){var n,o,r,s,l,a="0",h="native.jpg",c=Math.pow(.5,this.maxLevel-e),u="pct:"+100*c,m=Math.ceil(this.width*c),p=Math.ceil(this.height*c),d=Math.ceil(this.tileSize/c),g=Math.ceil(this.tileSize/c);return this.tile_width>m||this.tile_height>p?n="full":(o=t*d,r=i*g,s=Math.min(d,this.width-o),l=Math.min(g,this.height-r),n=[o,r,s,l].join(",")),[this.tilesUrl,this.identifier,n,u,a,h].join("/")}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},i.width&&i.height||(i.width=65572864,i.height=65572864),i.tileSize||(i.tileSize=256,i.tileOverlap=0),i.tilesUrl||(i.tilesUrl="http://tile.openstreetmap.org/"),i.minLevel=8,e.TileSource.apply(this,[i])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var n,o=256*Math.ceil(i.width/256),r=256*Math.ceil(i.height/256);n=o>r?o/256:r/256,i.maxLevel=Math.ceil(Math.log(n)/Math.log(2))-1,i.tileSize=256,i.width=o,i.height=r,e.TileSource.apply(this,[i])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"==e.type
},configure:function(e){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){function t(e){var t,i,n=[];for(i=0;e.length>i;i++)t=e[i],t.height&&t.width&&t.url&&(t.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||t.mimetype&&t.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))&&n.push({url:t.url,width:Number(t.width),height:Number(t.height)});return n.sort(function(e,t){return e.height-t.height})}function i(t,i){if(!i||!i.documentElement)throw Error(e.getString("Errors.Xml"));var o,r,s=i.documentElement,l=s.tagName,a=null,h=[];if("image"==l)try{for(a={type:s.getAttribute("type"),levels:[]},h=s.getElementsByTagName("level"),r=0;h.length>r;r++)o=h[r],a.levels.push({url:o.getAttribute("url"),width:parseInt(o.getAttribute("width"),10),height:parseInt(o.getAttribute("height"),10)});return n(t,a)}catch(c){throw c instanceof Error?c:Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==l)throw Error("Legacy Image Pyramid Collections not yet supported.");if("error"==l)throw Error("Error: "+i)}throw Error("Unknown element "+l)}function n(e,t){return t.levels}e.LegacyTileSource=function(i){var n,o,r;e.isArray(i)&&(n={type:"legacy-image-pyramid",levels:i}),n.levels=t(n.levels),o=n.levels[n.levels.length-1].width,r=n.levels[n.levels.length-1].height,e.extend(!0,n,{width:o,height:r,tileSize:Math.max(r,o),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),e.TileSource.apply(this,[n]),this.levels=n.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(t){var o;return o=e.isPlainObject(t)?n(this,t):i(this,t)},getLevelScale:function(e){var t=0/0;return e>=this.minLevel&&this.maxLevel>=e&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var i=this.getLevelScale(t);return i?new e.Point(1,1):new e.Point(0,0)},getTileAtPoint:function(){return new e.Point(0,0)},getTileUrl:function(e){var t=null;return e>=this.minLevel&&this.maxLevel>=e&&(t=this.levels[e].url),t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t){options=e.isPlainObject(t)?t:{tileSize:arguments[0],tileSources:arguments[1],rows:arguments[2],layout:arguments[3]},options.layout||(options.layout="horizontal");var i=0,n=1,o=Math.ceil(options.tileSources.length/options.rows),r=o>=options.rows?o:options.rows;for("horizontal"==options.layout?(options.width=options.tileSize*o,options.height=options.tileSize*options.rows):(options.height=options.tileSize*o,options.width=options.tileSize*options.rows),options.tileOverlap=-options.tileMargin,options.tilesPerRow=o;options.tileSize*r>n;)n=2*n,i++;options.minLevel=i,e.TileSource.apply(this,[options])},e.extend(e.TileSourceCollection.prototype,e.TileSource.prototype,{getTileBounds:function(t,i,n){var o=this.dimensions.times(this.getLevelScale(t)),r=this.tileSize*i-this.tileOverlap,s=this.tileSize*n-this.tileOverlap,l=this.tileSize+1*this.tileOverlap,a=this.tileSize+1*this.tileOverlap,h=1/o.x;return l=Math.min(l,o.x-r),a=Math.min(a,o.y-s),new e.Rect(r*h,s*h,l*h,a*h)},configure:function(){},getTileUrl:function(){return null}})}(OpenSeadragon),function(e){function t(t){e.requestAnimationFrame(function(){i(t)})}function i(i){var n,o,r;i.shouldFade&&(n=+new Date,o=n-i.fadeBeginTime,r=1-o/i.fadeLength,r=Math.min(1,r),r=Math.max(0,r),i.imgGroup&&e.setElementOpacity(i.imgGroup,r,!0),r>0&&t(i))}function n(e){e.shouldFade=!0,e.fadeBeginTime=+new Date+e.fadeDelay,window.setTimeout(function(){t(e)},e.fadeDelay)}function o(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function r(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(o(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function s(t,i){t.element.disabled||(e.ButtonState.HOVER>=i&&t.currentState==e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),e.ButtonState.GROUP>=i&&t.currentState==e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),e.ButtonState.REST>=i&&t.currentState==e.ButtonState.GROUP&&(n(t),t.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var i=this;e.EventHandler.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("button"),this.element.href=this.element.href||"#",t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&3>e.Browser.version&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="")),this.addHandler("onPress",this.onPress),this.addHandler("onRelease",this.onRelease),this.addHandler("onClick",this.onClick),this.addHandler("onEnter",this.onEnter),this.addHandler("onExit",this.onExit),this.addHandler("onFocus",this.onFocus),this.addHandler("onBlur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t,n,o,s){o?(r(i,e.ButtonState.DOWN),i.raiseEvent("onEnter",i)):s||r(i,e.ButtonState.HOVER)},focusHandler:function(e,t,n,o){this.enterHandler(e,t,n,o),i.raiseEvent("onFocus",i)},exitHandler:function(t,n,o){s(i,e.ButtonState.GROUP),o&&i.raiseEvent("onExit",i)},blurHandler:function(e,t,n,o){this.exitHandler(e,t,n,o),i.raiseEvent("onBlur",i)},pressHandler:function(){r(i,e.ButtonState.DOWN),i.raiseEvent("onPress",i)},releaseHandler:function(t,n,o,l){o&&l?(s(i,e.ButtonState.HOVER),i.raiseEvent("onRelease",i)):o?s(i,e.ButtonState.GROUP):r(i,e.ButtonState.HOVER)},clickHandler:function(e,t,n){n&&i.raiseEvent("onClick",i)},keyHandler:function(e,t){return 13===t?(i.raiseEvent("onClick",i),i.raiseEvent("onRelease",i),!1):!0}}).setTracking(!0),s(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventHandler.prototype,{notifyGroupEnter:function(){r(this,e.ButtonState.GROUP)},notifyGroupExit:function(){s(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),o=this;if(this.element=t.element||e.makeNeutralElement("fieldgroup"),!t.group)for(this.label=e.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;n.length>i;i++)this.element.appendChild(n[i].element);this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;o.buttons.length>e;e++)o.buttons[e].notifyGroupEnter()},exitHandler:function(){var e,t=arguments.length>2?arguments[2]:null;if(!t)for(e=0;o.buttons.length>e;e++)o.buttons[e].notifyGroupExit()},releaseHandler:function(){var e,t=arguments.length>3?arguments[3]:null;if(!t)for(e=0;o.buttons.length>e;e++)o.buttons[e].notifyGroupExit()}}).setTracking(!0)},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler()},emulateExit:function(){this.tracker.exitHandler()}}}(OpenSeadragon),function(e){e.Rect=function(e,t,i,n){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0},e.Rect.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height)},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},toString:function(){return"["+Math.round(100*this.x)+","+Math.round(100*this.y)+","+Math.round(100*this.width)+"x"+Math.round(100*this.height)+"]"}}}(OpenSeadragon),function(e){function t(t,i,o){var r=Number(this.element.style.marginLeft.replace("px","")),s=Number(this.element.style.marginTop.replace("px","")),l=Number(this.element.style.width.replace("px","")),a=Number(this.element.style.height.replace("px","")),h=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-o.x>0?r>-(l-h.x)&&(this.element.style.marginLeft=r+2*o.x+"px",n(this,h.x,r+2*o.x)):0>-o.x&&0>r&&(this.element.style.marginLeft=r+2*o.x+"px",n(this,h.x,r+2*o.x)):-o.y>0?s>-(a-h.y)&&(this.element.style.marginTop=s+2*o.y+"px",n(this,h.y,s+2*o.y)):0>-o.y&&0>s&&(this.element.style.marginTop=s+2*o.y+"px",n(this,h.y,s+2*o.y))),!1}function i(t,i,o){var r=Number(this.element.style.marginLeft.replace("px","")),s=Number(this.element.style.marginTop.replace("px","")),l=Number(this.element.style.width.replace("px","")),a=Number(this.element.style.height.replace("px","")),h=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?o>0?r>-(l-h.x)&&(this.element.style.marginLeft=r-60*o+"px",n(this,h.x,r-60*o)):0>o&&0>r&&(this.element.style.marginLeft=r-60*o+"px",n(this,h.x,r-60*o)):0>o?s>h.y-a&&(this.element.style.marginTop=s+60*o+"px",n(this,h.y,s+60*o)):o>0&&0>s&&(this.element.style.marginTop=s+60*o+"px",n(this,h.y,s+60*o))),!1}function n(t,i,n){var o,r,s,l,a,h;for(o="horizontal"==t.scroll?t.panelWidth:t.panelHeight,r=Math.ceil(i/o)+5,s=Math.ceil((Math.abs(n)+i)/o)+1,r=s-r,r=0>r?0:r,h=r;s>h&&t.panels.length>h;h++)element=t.panels[h],element.activePanel||(l=new e.Viewer({id:element.id,tileSources:[t.viewer.tileSources[h]],element:element,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),l.displayRegion=e.makeNeutralElement("textarea"),l.displayRegion.id=element.id+"-displayregion",l.displayRegion.className="displayregion",a=l.displayRegion.style,a.position="relative",a.top="0px",a.left="0px",a.fontSize="0px",a.overflow="hidden",a.float="left",a.cssFloat="left",a.styleFloat="left",a.zIndex=999999999,a.cursor="default",a.width=t.panelWidth-4+"px",a.height=t.panelHeight-4+"px",l.displayRegion.innerTracker=new e.MouseTracker({element:l.displayRegion}),element.getElementsByTagName("form")[0].appendChild(l.displayRegion),element.activePanel=!0)}function o(e){return"horizontal"==this.scroll?e.element.style.marginBottom="0px":e.element.style.marginLeft="0px",!1}function r(t){return e.getElementSize(this.viewer.element),"horizontal"==this.scroll?t.element.style.marginBottom="-"+e.getElementSize(t.element).y/2+"px":t.element.style.marginLeft="-"+e.getElementSize(t.element).x/2+"px",!1}function s(e,t){switch(t){case 61:return i.call(this,this.tracker,null,1,null),!1;case 45:return i.call(this,this.tracker,null,-1,null),!1;case 48:case 119:case 87:case 38:return i.call(this,this.tracker,null,1,null),!1;case 115:case 83:case 40:return i.call(this,this.tracker,null,-1,null),!1;case 97:case 37:return i.call(this,this.tracker,null,-1,null),!1;case 100:case 39:return i.call(this,this.tracker,null,1,null),!1;default:return!0}}var l={};e.ReferenceStrip=function(a){var h,c,u,m=this,p=a.viewer,d=e.getElementSize(p.element);for(a.id||(a.id="referencestrip-"+ +new Date,this.element=e.makeNeutralElement("div"),this.element.id=a.id,this.element.className="referencestrip"),a=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},a,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,a),l[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,c=this.element.style,c.marginTop="0px",c.marginRight="0px",c.marginBottom="0px",c.marginLeft="0px",c.left="0px",c.bottom="0px",c.border="0px",c.background="#000",c.position="relative",e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,t),scrollHandler:e.delegate(this,i),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,r),keyHandler:e.delegate(this,s)}).setTracking(!0),a.width&&a.height?(this.element.style.width=a.width+"px",this.element.style.height=a.height+"px",p.addControl(this.element,e.ControlAnchor.BOTTOM_LEFT)):"horizontal"==a.scroll?(this.element.style.width=d.x*a.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=d.y*a.sizeRatio+"px",p.addControl(this.element,e.ControlAnchor.BOTTOM_LEFT)):(this.element.style.height=d.y*a.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=d.x*a.sizeRatio+"px",p.addControl(this.element,e.ControlAnchor.TOP_LEFT)),this.panelWidth=d.x*this.sizeRatio+8,this.panelHeight=d.y*this.sizeRatio+8,this.panels=[],u=0;p.tileSources.length>u;u++)h=e.makeNeutralElement("div"),h.id=this.element.id+"-"+u,h.style.width=m.panelWidth+"px",h.style.height=m.panelHeight+"px",h.style.display="inline",h.style.float="left",h.style.cssFloat="left",h.style.styleFloat="left",h.style.padding="2px",h.innerTracker=new e.MouseTracker({element:h,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(e){e.dragging=+new Date},releaseHandler:function(e,t,i,n){var o=e.element.id,r=Number(o.split("-")[2]),s=+new Date;i&&n&&e.dragging&&s-e.dragging<e.clickTimeThreshold&&(e.dragging=null,p.goToPage(r))}}).setTracking(!0),this.element.appendChild(h),h.activePanel=!1,this.panels.push(h);n(this,"vertical"==this.scroll?d.y:d.y,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventHandler.prototype,e.Viewer.prototype,{setFocus:function(t){var i,r=e.getElement(this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),l=Number(this.element.style.width.replace("px","")),a=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==r&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=r,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3),i>h+s.x-this.panelWidth?(i=Math.min(i,l-s.x),this.element.style.marginLeft=-i+"px",n(this,s.x,-i)):h>i&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",n(this,s.x,-i))):(i=Number(t)*(this.panelHeight+3),i>c+s.y-this.panelHeight?(i=Math.min(i,a-s.y),this.element.style.marginTop=-i+"px",n(this,s.y,-i)):c>i&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",n(this,s.y,-i))),this.currentPage=t,e.getElement(r.id+"-displayregion").focus(),o.call(this,this.innerTracker))},update:function(){return l[this.id].animating?(e.console.log("image reference strip update"),!0):!1}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,o,r,s){e.Rect.apply(this,[t,i,n,o]),this.minLevel=r,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:0,time:(new Date).getTime()},this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time}},e.Spring.prototype={resetTo:function(e){this.target.value=e,this.target.time=this.current.time,this.start.value=this.target.value,this.start.time=this.target.time},springTo:function(e){this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime},shiftBy:function(e){this.start.value+=e,this.target.value+=e},update:function(){this.current.time=(new Date).getTime(),this.current.value=this.current.time>=this.target.time?this.target.value:this.start.value+(this.target.value-this.start.value)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time))}}}(OpenSeadragon),function(e){var t={};e.Tile=function(e,t,i,n,o,r){this.level=e,this.x=t,this.y=i,this.bounds=n,this.exists=o,this.url=r,this.loaded=!1,this.loading=!1,this.element=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(t){var i=e.getElementSize(t);return this.loaded&&this.image?(this.element||(this.element=e.makeNeutralElement("img"),this.element.src=this.url,this.element.style.msInterpolationMode="nearest-neighbor",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.style.top=100*(this.position.y/i.y)+"%",this.style.left=100*(this.position.x/i.x)+"%",this.style.height=100*(this.size.y/i.y)+"%",this.style.width=100*(this.size.x/i.x)+"%",e.setElementOpacity(this.element,this.opacity),void 0):(e.console.warn("Attempting to draw tile %s when it's not yet loaded.",""+this),void 0)},drawCanvas:function(i){var n,o,r=this.position,s=this.size;return this.loaded&&(this.image||t[this.url])?(i.globalAlpha=this.opacity,1==i.globalAlpha&&this.url.match(".png")&&i.clearRect(r.x+1,r.y+1,s.x-2,s.y-2),t[this.url]||(o=document.createElement("canvas"),o.width=this.image.width,o.height=this.image.height,n=o.getContext("2d"),n.drawImage(this.image,0,0),t[this.url]=n,this.image=null),n=t[this.url],i.drawImage(n.canvas,0,0,n.canvas.width,n.canvas.height,r.x,r.y,s.x,s.y),void 0):(e.console.warn("Attempting to draw tile %s when it's not yet loaded.",""+this),void 0)},unload:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),t[this.url]&&delete t[this.url],this.element=null,this.image=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},e.Overlay=function(t,i,n){this.element=t,this.scales=i instanceof e.Rect,this.bounds=new e.Rect(i.x,i.y,i.width,i.height),this.position=new e.Point(i.x,i.y),this.size=new e.Point(i.width,i.height),this.style=t.style,this.placement=i instanceof e.Point?n:e.OverlayPlacement.TOP_LEFT},e.Overlay.prototype={adjust:function(t,i){switch(this.placement){case e.OverlayPlacement.TOP_LEFT:break;case e.OverlayPlacement.TOP:t.x-=i.x/2;break;case e.OverlayPlacement.TOP_RIGHT:t.x-=i.x;break;case e.OverlayPlacement.RIGHT:t.x-=i.x,t.y-=i.y/2;break;case e.OverlayPlacement.BOTTOM_RIGHT:t.x-=i.x,t.y-=i.y;break;case e.OverlayPlacement.BOTTOM:t.x-=i.x/2,t.y-=i.y;break;case e.OverlayPlacement.BOTTOM_LEFT:t.y-=i.y;break;case e.OverlayPlacement.LEFT:t.y-=i.y/2;break;default:case e.OverlayPlacement.CENTER:t.x-=i.x/2,t.y-=i.y/2}},destroy:function(){var e=this.element,t=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),t.top="",t.left="",t.position="",this.scales&&(t.width="",t.height="")},drawHTML:function(t){var i,n,o=this.element,r=this.style,s=this.scales;o.parentNode!=t&&(o.prevElementParent=o.parentNode,o.prevNextSibling=o.nextSibling,t.appendChild(o)),s||(this.size=e.getElementSize(o)),i=this.position,n=this.size,this.adjust(i,n),i=i.apply(Math.floor),n=n.apply(Math.ceil),r.left=i.x+"px",r.top=i.y+"px",r.position="absolute",r.display="block",s&&(r.width=n.x+"px",r.height=n.y+"px")},update:function(t,i){this.scales=t instanceof e.Rect,this.bounds=new e.Rect(t.x,t.y,t.width,t.height),this.placement=t instanceof e.Point?i:e.OverlayPlacement.TOP_LEFT}}}(OpenSeadragon),function(e){function t(t,i){var n=null,o=i.height&&i.width?new e.Rect(i.x||i.px,i.y||i.py,i.width,i.height):new e.Point(i.x||i.px,i.y||i.py),r=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());return n=e.getElement(i.id),n||(n=document.createElement("a"),n.href="#/overlay/"+r),n.id=r,e.addClass(n,i.className?i.className:"openseadragon-overlay"),void 0!==i.px&&(o=t.viewport.imageToViewportRectangle(o)),i.placement?new e.Overlay(n,t.viewport.pointFromPixel(o),e.OverlayPlacement[i.placement.toUpperCase()]):new e.Overlay(n,o)}function i(e){e.updateAgain=!1,e.viewer&&e.viewer.raiseEvent("update-viewport",{viewer:e.viewer});for(var t,i,o,r,l,a,h,c,m=null,p=!1,d=+new Date,g=e.viewport.getContainerSize(),v=e.viewport.getBounds(!0),f=v.getTopLeft(),y=v.getBottomRight(),T=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(0),!0).x,x=Math.max(e.source.minLevel,Math.floor(Math.log(e.minZoomImageRatio)/Math.log(2))),E=Math.min(Math.abs(e.source.maxLevel),Math.abs(Math.floor(Math.log(T/e.minPixelRatio)/Math.log(2))));e.lastDrawn.length>0;)t=e.lastDrawn.pop(),t.beingDrawn=!1;if(e.canvas.innerHTML="",O&&((e.canvas.width!=g.x||e.canvas.height!=g.y)&&(e.canvas.width=g.x,e.canvas.height=g.y),e.context.clearRect(0,0,g.x,g.y)),!(!e.wrapHorizontal&&(0>y.x||f.x>1)||!e.wrapVertical&&(0>y.y||f.y>e.normHeight))){for(e.wrapHorizontal||(f.x=Math.max(f.x,0),y.x=Math.min(y.x,1)),e.wrapVertical||(f.y=Math.max(f.y,0),y.y=Math.min(y.y,e.normHeight)),x=Math.min(x,E),i=E;i>=x;i--){if(o=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(i),!0).x,!p&&o>=e.minPixelRatio||i==x)drawLevel=!0,p=!0;else if(!p)continue;if(r=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(i),!1).x,l=e.viewport.deltaPixelsFromPoints(e.source.getPixelRatio(Math.max(e.source.getClosestLevel(e.viewport.containerSize)-1,0)),!1).x,a=e.immediateRender?1:l,h=Math.min(1,(o-.5)/.5),c=a/Math.abs(a-r),m=n(e,p,i,h,c,f,y,d,m),u(e.coverage,i))break}S(e,e.lastDrawn),w(e.viewport,e.overlays,e.container),m&&(s(e,m,d),e.updateAgain=!0)}}function n(e,t,i,n,r,s,l,a,h){var c,u,m,p,g,v=e.viewport.pixelFromPoint(e.viewport.getCenter());for(e.viewer&&e.viewer.raiseEvent("update-level",{viewer:e.viewer,havedrawn:t,level:i,opacity:n,visibility:r,topleft:s,bottomright:l,currenttime:a,best:h}),m=e.source.getTileAtPoint(i,s),p=e.source.getTileAtPoint(i,l),g=e.source.getNumTiles(i),d(e.coverage,i),e.wrapHorizontal||(p.x=Math.min(p.x,g.x-1)),e.wrapVertical||(p.y=Math.min(p.y,g.y-1)),c=m.x;p.x>=c;c++)for(u=m.y;p.y>=u;u++)h=o(e,drawLevel,t,c,u,i,n,r,v,g,a,h);return h}function o(e,t,i,n,o,s,l,c,u,d,g,f){var w=r(n,o,s,e.source,e.tilesMatrix,g,d,e.normHeight),y=t;return e.viewer&&e.viewer.raiseEvent("update-tile",{viewer:e.viewer,tile:w}),p(e.coverage,s,n,o,!1),w.exists?(i&&!y&&(m(e.coverage,s,n,o)?p(e.coverage,s,n,o,!0):y=!0),y?(a(w,e.source.tileOverlap,e.viewport,u,c),w.loaded?e.updateAgain=h(e,w,n,o,s,l,g):w.loading||(f=v(f,w)),f):f):f}function r(t,i,n,o,r,s,l,a){var h,c,u,m,p,d;return r[n]||(r[n]={}),r[n][t]||(r[n][t]={}),r[n][t][i]||(h=(l.x+t%l.x)%l.x,c=(l.y+i%l.y)%l.y,u=o.getTileBounds(n,h,c),m=o.tileExists(n,h,c),p=o.getTileUrl(n,h,c),u.x+=1*(t-h)/l.x,u.y+=a*(i-c)/l.y,r[n][t][i]=new e.Tile(n,t,i,u,m,p)),d=r[n][t][i],d.lastTouchTime=s,d}function s(e,t,i){e.viewport.collectionMode?(e.midUpdate=!1,l(e,t,i)):t.loading=e.loadImage(t.url,function(n){l(e,t,i,n)})}function l(t,i,n,o){var r,s,l,a,h,c,u,m,p,d;if(i.loading=!1,t.midUpdate)return e.console.warn("Tile load callback in middle of drawing routine."),void 0;if(o||t.viewport.collectionMode){if(t.lastResetTime>n)return e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void 0}else if(e.console.log("Tile %s failed to load: %s",i,i.url),!t.debugMode)return i.exists=!1,void 0;if(i.loaded=!0,i.image=o,r=t.tilesLoaded.length,t.tilesLoaded.length>=t.maxImageCacheCount){for(s=Math.ceil(Math.log(t.source.tileSize)/Math.log(2)),l=null,c=-1,d=t.tilesLoaded.length-1;d>=0;d--)u=t.tilesLoaded[d],u.level<=t.cutoff||u.beingDrawn||(l?(m=u.lastTouchTime,a=l.lastTouchTime,p=u.level,h=l.level,(a>m||m==a&&p>h)&&(l=u,c=d)):(l=u,c=d));l&&c>=0&&(l.unload(),r=c)}t.tilesLoaded[r]=i,t.updateAgain=!0}function a(t,i,n,o,r){var s=t.bounds.getTopLeft(),l=t.bounds.getSize(),a=n.pixelFromPoint(s,!0),h=n.pixelFromPoint(s,!1),c=n.deltaPixelsFromPoints(l,!0),u=n.deltaPixelsFromPoints(l,!1),m=h.plus(u.divide(2)),p=o.distanceTo(m);i||(c=c.plus(new e.Point(1,1))),t.position=a,t.size=c,t.distance=p,t.visibility=r}function h(e,t,i,n,o,r,s){var l,a,h=1e3*e.blendTime;if(t.blendStart||(t.blendStart=s),l=s-t.blendStart,a=h?Math.min(1,l/h):1,e.alwaysBlend&&(a*=r),t.opacity=a,e.lastDrawn.push(t),1==a)p(e.coverage,o,i,n,!0);else if(h>l)return!0;return!1}function c(e){e.tilesMatrix={},e.tilesLoaded=[]}function u(e,t,i,n){var o,r,s,l;if(!e[t])return!1;if(void 0===i||void 0===n){o=e[t];for(s in o)if(o.hasOwnProperty(s)){r=o[s];for(l in r)if(r.hasOwnProperty(l)&&!r[l])return!1}return!0}return void 0===e[t][i]||void 0===e[t][i][n]||e[t][i][n]===!0}function m(e,t,i,n){return void 0===i||void 0===n?u(e,t+1):u(e,t+1,2*i,2*n)&&u(e,t+1,2*i,2*n+1)&&u(e,t+1,2*i+1,2*n)&&u(e,t+1,2*i+1,2*n+1)}function p(t,i,n,o,r){return t[i]?(t[i][n]||(t[i][n]={}),t[i][n][o]=r,void 0):(e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i),void 0)}function d(e,t){e[t]={}}function g(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element==t)return i;return-1}function v(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function f(t,i,n,o){t.onload=null,t.onabort=null,t.onerror=null,o&&window.clearTimeout(o),e.requestAnimationFrame(function(){i(t.src,n?t:null)})}function w(e,t,i){var n,o=t.length;for(n=0;o>n;n++)y(e,t[n],i)}function y(e,t,i){t.position=e.pixelFromPoint(t.bounds.getTopLeft(),!0),t.size=e.deltaPixelsFromPoints(t.bounds.getSize(),!0),t.drawHTML(i)}function S(t,i){var n,o,r,s,l,a,h,c;for(n=i.length-1;n>=0;n--){if(o=i[n],t.viewport.collectionMode?(r=o.x+"/"+o.y,l=t.viewport,c=l.collectionTileSource,t.collectionOverlays[r]?(s=t.collectionOverlays[r],s.viewport&&(s.viewport.resize(o.size,!0),s.viewport.goHome(!0))):(a="horizontal"==c.layout?o.y+o.x*c.rows:o.x+o.y*c.rows,h=c.tileSources.length>a?c.tileSources[a]:null,h&&(t.collectionOverlays[r]=s=new e.Viewer({element:e.makeNeutralElement("div"),mouseNavEnabled:!1,showNavigator:!1,showSequenceControl:!1,showNavigationControl:!1,tileSources:[h]}),R&&(s.element.style.border="1px solid rgba(255,255,255,0.38)",s.element.style["-webkit-box-reflect"]="below 0px -webkit-gradient(linear,left top,left bottom,from(transparent),color-stop(62%,transparent),to(rgba(255,255,255,0.62)))"),t.addOverlay(s.element,o.bounds)))):(O?o.drawCanvas(t.context):o.drawHTML(t.canvas),o.beingDrawn=!0),t.debugMode)try{T(t,o,i.length,n)}catch(u){e.console.error(u)}t.viewer&&t.viewer.raiseEvent("tile-drawn",{viewer:t.viewer,tile:o})}}function T(e,t,i,n){O&&(e.context.save(),e.context.lineWidth=2,e.context.font="small-caps bold 13px ariel",e.context.strokeStyle=e.debugGridColor,e.context.fillStyle=e.debugGridColor,e.context.strokeRect(t.position.x,t.position.y,t.size.x,t.size.y),0===t.x&&0===t.y&&(e.context.fillText("Zoom: "+e.viewport.getZoom(),t.position.x,t.position.y-30),e.context.fillText("Pan: "+(""+e.viewport.getBounds()),t.position.x,t.position.y-20)),e.context.fillText("Level: "+t.level,t.position.x+10,t.position.y+20),e.context.fillText("Column: "+t.x,t.position.x+10,t.position.y+30),e.context.fillText("Row: "+t.y,t.position.x+10,t.position.y+40),e.context.fillText("Order: "+n+" of "+i,t.position.x+10,t.position.y+50),e.context.fillText("Size: "+(""+t.size),t.position.x+10,t.position.y+60),e.context.fillText("Position: "+(""+t.position),t.position.x+10,t.position.y+70),e.context.restore())}var x=e.getWindowSize(),E=e.Browser.vendor,b=e.Browser.version,R=E==e.BROWSERS.FIREFOX||E==e.BROWSERS.OPERA||E==e.BROWSERS.SAFARI&&b>=4||E==e.BROWSERS.CHROME&&b>=2||E==e.BROWSERS.IE&&b>=9,O=R&&!(400>=x.x||400>=x.y)&&!navigator.appVersion.match("Mobile")&&e.isFunction(document.createElement("canvas").getContext);e.Drawer=function(i){var n,o=arguments;for(e.isPlainObject(i)||(i={source:o[0],viewport:o[1],element:o[2]}),e.extend(!0,this,{downloading:0,tilesMatrix:{},tilesLoaded:[],coverage:{},lastDrawn:[],lastResetTime:0,midUpdate:!1,updateAgain:!0,overlays:[],collectionOverlays:{},maxImageCacheCount:e.DEFAULT_SETTINGS.maxImageCacheCount,imageLoaderLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,debugMode:e.DEFAULT_SETTINGS.debugMode,timeout:e.DEFAULT_SETTINGS.timeout},i),this.container=e.getElement(this.element),this.canvas=e.makeNeutralElement(O?"canvas":"div"),this.context=O?this.canvas.getContext("2d"):null,this.normHeight=this.source.dimensions.y/this.source.dimensions.x,this.element=this.container,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.container.style.textAlign="left",this.container.appendChild(this.canvas),n=0;this.overlays.length>n;n++)e.isPlainObject(this.overlays[n])?this.overlays[n]=t(this,this.overlays[n]):e.isFunction(this.overlays[n])},e.Drawer.prototype={addOverlay:function(t,i,n){return t=e.getElement(t),g(this.overlays,t)>=0?void 0:(this.overlays.push(new e.Overlay(t,i,n)),this.updateAgain=!0,this.viewer&&this.viewer.raiseEvent("add-overlay",{viewer:this.viewer,element:t,location:i,placement:n}),this)},updateOverlay:function(t,i,n){var o;return t=e.getElement(t),o=g(this.overlays,t),o>=0&&(this.overlays[o].update(i,n),this.updateAgain=!0),this.viewer&&this.viewer.raiseEvent("update-overlay",{viewer:this.viewer,element:t,location:i,placement:n}),this},removeOverlay:function(t){var i;return t=e.getElement(t),i=g(this.overlays,t),i>=0&&(this.overlays[i].destroy(),this.overlays.splice(i,1),this.updateAgain=!0),this.viewer&&this.viewer.raiseEvent("remove-overlay",{viewer:this.viewer,element:t}),this},clearOverlays:function(){for(;this.overlays.length>0;)this.overlays.pop().destroy(),this.updateAgain=!0;
return this.viewer&&this.viewer.raiseEvent("clear-overlay",{viewer:this.viewer}),this},needsUpdate:function(){return this.updateAgain},numTilesLoaded:function(){return this.tilesLoaded.length},reset:function(){return c(this),this.lastResetTime=+new Date,this.updateAgain=!0,this},update:function(){return this.midUpdate=!0,i(this),this.midUpdate=!1,this},loadImage:function(t,i){var n,o,r,s=this,l=!1;return(!this.imageLoaderLimit||this.downloading<this.imageLoaderLimit)&&(this.downloading++,n=new Image,r=function(n,o){if(s.downloading--,"function"==typeof i)try{i(o)}catch(r){e.console.error("%s while executing %s callback: %s",r.name,t,r.message,r)}},n.onload=function(){f(n,r,!0,o)},n.onabort=n.onerror=function(){f(n,r,!1,o)},o=window.setTimeout(function(){f(n,r,!1,o)},this.timeout),l=!0,n.src=t),l}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel},t),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.resetContentSize(this.contentSize),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return this.contentSize=t,this.contentAspectX=this.contentSize.x/this.contentSize.y,this.contentAspectY=this.contentSize.y/this.contentSize.x,this.fitWidthBounds=new e.Rect(0,0,1,this.contentAspectY),this.fitHeightBounds=new e.Rect(0,0,this.contentAspectY,this.contentAspectY),this.homeBounds=new e.Rect(0,0,1,this.contentAspectY),this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:t,viewer:this.viewer}),this},getHomeZoom:function(){var e=this.contentAspectX/this.getAspectRatio();return this.defaultZoomLevel?this.defaultZoomLevel:e>=1?1:e},getHomeBounds:function(){var t=this.homeBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e,viewer:this.viewer}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return Math.min(t,e)},getMaxZoom:function(){var e=this.maxZoomLevel?this.maxZoomLevel:this.contentSize.x*this.maxZoomPixelRatio/this.containerSize.x;return Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this.containerSize.x/this.containerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getBounds:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),o=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-o/2,n,o)},getCenter:function(t){var i,n,o,r,s,l,a,h,c=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),u=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?c:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),n=this.getZoom(),o=1/n,r=o/this.getAspectRatio(),s=new e.Rect(c.x-o/2,c.y-r/2,o,r),l=this.zoomPoint.minus(s.getTopLeft()).times(this.containerSize.x/s.width),a=l.minus(i),h=a.divide(this.containerSize.x*n),u.plus(h)):u},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},applyConstraints:function(e){var t,i,n,o,r,s,l,a=this.getZoom(),h=Math.max(Math.min(a,this.getMaxZoom()),this.getMinZoom()),c=0,u=0;return a!=h&&this.zoomTo(h,this.zoomPoint,e),t=this.getBounds(),i=this.visibilityRatio*t.width,n=this.visibilityRatio*t.height,o=t.x+t.width,r=1-t.x,s=t.y+t.height,l=this.contentAspectY-t.y,this.wrapHorizontal||(i>o&&(c=i-o),i>r&&(c=c?(c+r-i)/2:r-i)),this.wrapVertical||(n>s&&(u=n-s),n>l&&(u=u?(u+l-n)/2:l-n)),(c||u||e)&&(t.x+=c,t.y+=u,t.width>1&&(t.x=.5-t.width/2),t.height>this.contentAspectY&&(t.y=this.contentAspectY/2-t.height/2),this.fitBounds(t,e)),this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e,viewer:this.viewer}),this},ensureVisible:function(e){return this.applyConstraints(e)},fitBounds:function(t,i){var n,o,r,s,l=this.getAspectRatio(),a=t.getCenter(),h=new e.Rect(t.x,t.y,t.width,t.height);return h.getAspectRatio()>=l?(h.height=t.width/l,h.y=a.y-h.height/2):(h.width=t.height*l,h.x=a.x-h.width/2),this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),n=this.getBounds(),o=this.getZoom(),r=1/h.width,r==o||h.width==n.width?this.panTo(a,i):(s=n.getTopLeft().times(this.containerSize.x/n.width).minus(h.getTopLeft().times(this.containerSize.x/h.width)).divide(this.containerSize.x/n.width-this.containerSize.x/h.width),this.zoomTo(r,s,i))},fitVertically:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(1+t.x%1)%1,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(this.contentAspectY+t.y%this.contentAspectY)%this.contentAspectY,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitHeightBounds,e)},fitHorizontally:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(this.contentAspectX+t.x%this.contentAspectX)%this.contentAspectX,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(1+t.y%1)%1,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitWidthBounds,e)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t,viewer:this.viewer}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(t,i,n){return this.zoomPoint=i instanceof e.Point?i:null,n?this.zoomSpring.resetTo(t):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n,viewer:this.viewer}),this},resize:function(t,i){var n=this.getBounds(),o=n,r=t.x/this.containerSize.x;return this.containerSize=new e.Point(t.x,t.y),i&&(o.width=n.width*r,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i,viewer:this.viewer}),this.fitBounds(o,!0)},update:function(){var e,t,i,n,o=this.centerSpringX.current.value,r=this.centerSpringY.current.value,s=this.zoomSpring.current.value;return this.zoomPoint&&(e=this.pixelFromPoint(this.zoomPoint,!0)),this.zoomSpring.update(),this.zoomPoint&&this.zoomSpring.current.value!=s?(t=this.pixelFromPoint(this.zoomPoint,!0),i=t.minus(e),n=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y)):this.zoomPoint=null,this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!=o||this.centerSpringY.current.value!=r||this.zoomSpring.current.value!=s},deltaPixelsFromPoints:function(e,t){return e.times(this.containerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return e.divide(this.containerSize.x*this.getZoom(t))},pixelFromPoint:function(e,t){var i=this.getBounds(t);return e.minus(i.getTopLeft()).times(this.containerSize.x/i.width)},pointFromPixel:function(e,t){var i=this.getBounds(t);return e.divide(this.containerSize.x/i.width).plus(i.getTopLeft())},viewportToImageCoordinates:function(t,i){return new e.Point(t*this.contentSize.x,i*this.contentSize.y*this.contentAspectX)},imageToViewportCoordinates:function(t,i){return new e.Point(t/this.contentSize.x,i/this.contentSize.y/this.contentAspectX)},imageToViewportRectangle:function(t,i,n,o){var r,s,l;return 1==arguments.length?(l=t,this.imageToViewportRectangle(l.x,l.y,l.width,l.height)):(r=this.imageToViewportCoordinates(t,i),s=this.imageToViewportCoordinates(n,o),new e.Rect(r.x,r.y,r.x+s.x,r.y+s.y))}}}(OpenSeadragon);